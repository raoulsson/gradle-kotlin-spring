import org.jetbrains.kotlin.gradle.tasks.KotlinCompile
//import nu.studer.gradle.jooq.JooqEdition
//import org.jooq.meta.jaxb.Logging

plugins {
//    id("vg-kotlin-convention")
    id("vg-spring-convention")
    id("org.jetbrains.kotlin.plugin.jpa")
//    kotlin("plugin.allopen")
//    kotlin("plugin.jpa")
//    id("nu.studer.jooq")
//    id("org.flywaydb.flyway")
}

//sourceSets {
//    getByName("main").java.srcDirs("src/main/kotlin")
//    getByName("main").java.srcDirs("src/main/jooq")
//    getByName("test").java.srcDirs("src/test/kotlin")
//}

//extra["snippetsDir"] = file("build/generated-snippets")
//val snippetsDir = extra["snippetsDir"] as File
//
//val jooqDb = mapOf(
//    "driver" to "org.mariadb.jdbc.Driver",
//    "url" to "jdbc:mariadb://127.0.0.1:3306/video_games",
//    "schema" to "video_games",
//    "user" to "user",
//    "password" to "password",
//    "jooq_db_type" to "org.jooq.meta.mysql.MySQLDatabase"
//)

dependencies {
    implementation("org.springframework.boot:spring-boot-starter-data-jpa")
    implementation("org.springframework.boot:spring-boot-starter-jooq")
    implementation("org.springframework.boot:spring-boot-starter-data-jpa")

    implementation("org.flywaydb:flyway-core")
    implementation("org.flywaydb:flyway-mysql")
    implementation("org.flywaydb:flyway-gradle-plugin")

    implementation("org.jooq:jooq-kotlin")

    implementation("org.hsqldb:hsqldb")

    runtimeOnly("com.h2database:h2")
    runtimeOnly("org.mariadb.jdbc:mariadb-java-client")

//    jooqGenerator("com.h2database:h2")
//    jooqGenerator("org.mariadb.jdbc:mariadb-java-client")

    testImplementation("org.springframework.boot:spring-boot-starter-test")
    testImplementation("org.hsqldb:hsqldb")
    testImplementation("org.liquibase:liquibase-core")
}

//allOpen {
//    annotation("jakarta.persistence.Entity")
//    annotation("jakarta.persistence.Embeddable")
//    annotation("jakarta.persistence.MappedSuperclass")
//}

//jooq {
//	version.set("3.17.6")
//	edition.set(JooqEdition.OSS)
//
//	configurations {
//		create("main") {
//			jooqConfiguration.apply {
//				logging = Logging.DEBUG
//				jdbc.apply {
//					driver = jooqDb["driver"]
//					url = jooqDb["url"]
//					user = jooqDb["user"]
//					password = jooqDb["password"]
//				}
//				generator.apply {
//					name = "org.jooq.codegen.KotlinGenerator"
//					database.apply {
//						name = jooqDb["jooq_db_type"]
//						inputSchema = jooqDb["schema"]
//					}
//					generate.apply {
//						isDeprecated = false
//						isRecords = true
//						isImmutablePojos = false
//						isFluentSetters = true
//						//withPojos(true)
//						//withDaos(true)
//						//withSerializablePojos(false)
//						withSequences(true)
//					}
//					target.apply {
//						packageName = "com.example.videogames.jooq"
//						directory = "src/main/jooq/"
//					}
//					strategy.name = "org.jooq.codegen.DefaultGeneratorStrategy"
//				}
//			}
//		}
//	}
//}
