import org.jetbrains.kotlin.gradle.tasks.KotlinCompile
//import com.diffplug.gradle.spotless.SpotlessExtension

plugins {
    kotlin("jvm")
    kotlin("plugin.spring")
    kotlin("kapt")
    id("com.diffplug.spotless")
    id("org.jetbrains.dokka")
}

repositories {
    mavenCentral()
    google()
}

pluginManagement {
    repositories {
        gradlePluginPortal()
    }
}

configurations {
    compileOnly {
        extendsFrom(configurations.annotationProcessor.get())
    }
}

object VersionsLocal {
    const val javaTargetVersion = "11"
    const val kotlinPlugin = "1.6.10"
    const val kotlin = "1.8.0"
    const val springBoot = "2.7.6"
    const val dependencyManagement = "1.0.11.RELEASE"
    const val liquibasePlugin = "2.1.1"
    const val spotless = "6.6.1"
    const val junit = "5.8.2"
    const val junitJupiter = "5.8.2"
    const val hamcrest = "2.2"
    const val studer = "8.1"
    const val jooq = "3.17.7"
    const val dokka = "1.7.20"
    const val flyway = "9.14.1"
    const val hsql = "2.7.1"
    const val h2 = "2.1.214"
    const val mariaDbDriver = "3.1.2"
    const val liquibase = "4.19.0"
//    const val asciidoctorPlugin = "1.5.7"
//    const val asciidoctor = "3.3.2"
}

dependencies {
    implementation("org.jetbrains.kotlin:kotlin-reflect")
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
}

//configure<SpotlessExtension> {
//    kotlin {
//        ktlint().userData(mapOf("disabled_rules" to "import-ordering"))
//    }
//}

//tasks.withType<JavaCompile> {
//    options.encoding = "UTF-8"
//}

tasks.withType<KotlinCompile> {
    kotlinOptions {
        freeCompilerArgs = listOf("-Xjsr305=strict")
        jvmTarget = "11"
    }
}

tasks.withType<Test> {
    useJUnitPlatform()
}

tasks.named("clearBackend")  {
    dependsOn("clean")
}

tasks.named("produceBackend")  {
    dependsOn("assemble")
}

tasks.named("auditBackend")  {
    dependsOn("spotlessKotlinCheck")
}

tasks.named("verifyBackend")  {
    dependsOn("check")
}

tasks.named("makeBackend")  {
    dependsOn("build")
}